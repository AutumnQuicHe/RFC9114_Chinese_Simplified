---
title: "6.2. 单向流"
anchor: "6.2_Unidirectional_Streams"
weight: 60200
rank: "h2"
---

单向流，无论哪个方向，具有多种用途。
单向流的具体的用途是由流类型决定的，它以可变长度整型的形式出现在流的起始处。
跟在该整型值后方的数据的格式是由流类型决定的。

{{% block_ref
indx="Figure_1_Unidirectional_Stream_Header"
title="图1：单向流的头部" %}}

```
单向流的头部 {
  流类型 (i),
}
```

{{% /block_ref %}}

本文档定义了两种流类型：控制流（详见[第6.2.1章]()）和推送流（详见[6.2.2章]()）。
《[QPACK]()》定义了两种额外的帧类型。
HTTP/3的扩展还可以定义其他流类型；详见[第9章]()。
某些流类型是被保留使用的（详见[第6.2.3章]()）。

在一条HTTP/3连接的生命周期的早期阶段，单向流上的数据创建与通信很容易影响到连接的性能。
过度限制流的最大数量或这些流的流量控制窗口的终端将增大对端迅速抵达这些上限值并被阻塞的可能性。
特别是，实现应该考虑到对端可能想要通过某些允许使用的单向流来利用被保留使用的流的行为（详见[第6.2.3章]()）。

每个终端都需要创建至少一条作为HTTP控制流的单向流。
除此之外，QPACK需要两条单向流，并且其他扩展还可能需要更多流。
因此，客户端和服务器发送的传输参数都 {{< req_level MUST >}}允许对端创建至少三条单向流。
这些传输参数还{{< req_level SHOULD >}}为每条单向流提供至少1024字节的流量控制额度。

注意，如果对端在创建关键的单向流前就用完了所有的初始额度，那么终端没有必要额外提供用于创建更多单向流的额度。
终端{{< req_level SHOULD >}}首先创建HTTP控制流和强制使用的扩展（例如QPACK的编码器流和解码器流）所需的单向流，然后再在对端允许下创建额外的流。

如果流的头部位置是一种不被接收方支持的流类型，那么就不能用已知的语义来使用流的剩余部分。
未知类型的流的接收方 {{< req_level MUST >}}要么中止流的读取，要么丢弃传入数据且不进行任何处理。
如果选择中止读取，那么接收方{{< req_level SHOULD >}}使用错误码`H3_STREAM_CREATION_ERROR`（流创建错误）或某被保留使用的错误码（详见[第8.1章]()）。
接收方{{< req_level MUST_NOT >}}将接收到未知类型的流的情况视作为任何类型的连接错误。

由于特定的流类型可以影响连接状态，因此接收方{{< req_level SHOULD_NOT >}}在读取单向流的流类型前就丢弃传入的数据。

实现{{< req_level MAY >}}在了解到对端是否支持某些流类型前就将它们发送出去。
然而，在了解到对端支持与否之前，{{< req_level MUST_NOT >}}发送会修改现存协议组件的状态或语义的流类型，包括QPACK或其他扩展。

除非特别规定，否则发送方可以关闭或重置一条单向流。
接收方 {{< req_level MUST >}}容忍在接收到单向流的头部前单向流就被关闭或重置的情况。
