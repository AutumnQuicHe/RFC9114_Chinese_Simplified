---
title: "3.3. 连接的复用"
anchor: "3.3_Connection_Reuse"
weight: 30300
rank: "h2"
---

即使经过多次请求，HTTP/3连接也会保持开放。
为了保持最佳性能，允许客户端将连接保持开放，直到它判断无需与服务器进行更多通信（例如，当用户从某网页跳转去了别的地方）或直到服务器关闭了连接。

只要一条与某服务器终端的连接存在，该连接就{{< req_level MAY >}}被复用于具有不同的URI授权机构部分的其他请求。
要为新的源使用一条现存的连接，客户端 {{< req_level MUST >}}使用在《[HTTP]()》的[第4.3.4章]()中描述的过程来验证由服务器提供的证书与新的源服务器是否匹配。
这意味着客户端需要保留客户端证书及用于验证证书的附加信息；不这么做的客户端将无法为其他的源复用连接。

只要证书因为任何理由不适用于新的源，那么连接{{< req_level MUST_NOT >}}被复用，{{< req_level SHOULD >}}为这个新的源连理新的连接。
如果使得证书无法通过验证的原因还适用于其他已经关联到此准备复用的连接上的源，那么客户端{{< req_level SHOULD >}}为这些源重新验证服务器证书。
例如，如果某个证书的验证是因为证书已经过期或已被吊销而没有通过的，那么就能用这条理由来令所有正使用着该证书的源的权威性都无效。

对于一对给定的IP地址和UDP端口，客户端{{< req_level SHOULD_NOT >}}打开超过一条HTTP/3连接，无论这对IP地址和端口是由URI、所选的替代服务（详见《[ALTSVC]()》）或代理配置给出的，还是由以上之一的名称解析而产生的。
客户端{{< req_level MAY >}}使用不同的传输或TLS配置来向相同的IP地址和UDP端口对打开多条HTTP/3连接，但{{< req_level SHOULD >}}避免使用相同配置创建复数条连接。

建议服务器尽可能久地将HTTP/3连接维持在开放状态，但是在有必要时允许服务器终止空闲的连接。
当任一终端选择关闭HTTP/3连接时，正在关闭连接的终端{{< req_level SHOULD >}}首先发送一个**关闭帧**（详见[第5.2章]()），从而让双方都能对先前发送的帧是否已得到处理做出可靠的判断，并且优雅地关闭或终止所有必要的且仍在运行的任务。

不希望客户端为某个特定源复用HTTP/3连接的服务器可以通过发送状态码`421`（`Misdirected Request`，误定向的请求）来对请求作出响应的方式，表明自己对该请求不具有权威性；详见《[HTTP]()》的[第7.4章]()。
