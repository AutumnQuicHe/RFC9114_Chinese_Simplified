---
title: "7.2.4. 设置帧"
anchor: "7.2.4_SETTINGS"
weight: 70240
rank: "h3"
---

**设置帧**（类型值为`0x04`）传递的是能影响终端的通信方式的配置参数，例如自身的偏好和对对端行为的限制。
**设置帧**中的单个参数可以被称为”设置“；每个设置参数的标识符和值被称为”设置标识符“和”设置值“。

**设置帧**总是应用在整条HTTP/3连接上，而从不会是单条流。
**设置帧** {{< req_level MUST >}}在每条控制流上（详见[第6.2.1章]()）被各个终端作为首个帧来发送，而且{{< req_level MUST_NOT >}}被连续发送。
如果终端在控制流上接收到了第二个**设置帧**，那么终端 {{< req_level MUST >}}使用类型为`H3_FRAME_UNEXPECTED`的连接错误来响应这种情况。

在并非控制流的其他流上{{< req_level MUST_NOT >}}发送设置帧。
如果终端在另一条流上接收到了**设置帧**，那么终端 {{< req_level MUST >}}使用类型为`H3_FRAME_UNEXPECTED`的连接错误来响应这种情况。

**设置帧**的参数不是由协商得到的；它们描述了接收方能够使用的发送方特性。
不过，可以使用**设置帧**来隐式地协商：每个终端都使用**设置帧**来宣告一组支持的值。
最终的设置就取决于各终端如何合并这两组设置。
**设置帧**并没有提供一种分辨哪一方的设置最终起效的机制。

终端间可以对相同的参数宣告不同的值。
例如，客户端可能愿意接受一个非常大的响应字段组，而服务器对请求的尺寸更为敏感。

同样的设置标识符{{< req_level MUST_NOT >}}在同一**设置帧**中多次出现。
接收方{{< req_level MAY >}}将接收到重复的设置标识符的情况视作类型为`H3_SETTINGS_ERROR`（设置错误）的连接错误。

**设置帧**的载荷由数个参数组成（可以为零）。
每个参数由一个设置标识符和一个值组成，两者均被编码为QUIC可变长度整型。

{{% block_ref
indx="Figure_7_SETTINGS_Frame"
title="图7：设置帧" %}}

```
设置 {
  标识符 (i),
  值 (i),
}

取消推送帧 {
  类型 (i) = 0x04,
  长度 (i),
  设置 (..),
}
```

{{% /block_ref %}}

如果实现不认识某个参数的标识符，那么实现 {{< req_level MUST >}}忽略这个参数。
