---
title: "7.2.3. 取消推送帧"
anchor: "7.2.3_CANCEL_PUSH"
weight: 70230
rank: "h3"
---

**取消推送帧**（类型值为`0x03`）的用途是在推送流被接收到前要求取消服务器推送。
**取消推送帧**使用推送ID（详见[第4.6章]()）来代表某服务器推送，它被编码为一个可变长度整型。

当客户端发送**取消推送帧**时，它是在表明它不希望接收到被承诺的资源。
这时服务器{{< req_level SHOULD >}}中止发送资源，但是该中止机制能否起效取决于相关推送流的状态。
如果服务器尚未创建推送流，那么它就不会创建。
如果推送流已经打开，那么服务器{{< req_level SHOULD >}}中止该流。
如果推送流已经关闭，那么服务器{{< req_level MAY >}}中止该流，也{{< req_level MAY >}}什么都不做。

当服务器发送**取消推送帧**时，它是在表明它将不会兑现某个曾经发送的承诺。
客户端无法再期待相关承诺得到兑现，除非它已经接收到且处理了这项被承诺的资源。
无论推送流是否已被打开，服务器都{{< req_level SHOULD >}}在决定不再兑现承诺时发送**取消推送帧**。
如果已经打开了推送流，那么服务器可以用错误码`H3_REQUEST_CANCELLED`（请求被取消）来中止在流上的发送。

**取消推送帧**的请求对现存推送流的状态没有直接影响。
客户端{{< req_level SHOULD_NOT >}}在已经接收到相关推送流的情况下任然发送**取消推送帧**。
在客户端发出**取消推送帧**后依然有可能接收到推送流，因为服务器可能没有处理到这个**取消推送帧**。
客户端{{< req_level SHOULD >}}使用错误码`H3_REQUEST_CANCELLED`来中止在流上的读取。

**取消推送流**是在控制流上发送的。
如果在并非控制流的某条流上接收到了**取消推送流**，那么 {{< req_level MUST >}}将该情况视作类型为`H3_FRAME_UNEXPECTED`的连接错误。

{{% block_ref
indx="Figure_6_CANCEL_PUSH_Frame"
title="图6：取消推送帧" %}}

```
取消推送帧 {
  类型 (i) = 0x03,
  长度 (i),
  推送ID (i),
}
```

{{% /block_ref %}}

**取消推送帧**携带着一个经过可变长度整形编码的推送ID。
推送ID字段标识了将要取消的服务器推送，详见[第4.6章]()。
如果接收到的**取消推送帧**中使用的推送ID大于当前连接上所允许的最大推送ID，那么 {{< req_level MUST >}}将该情况视作类型为`H3_ID_ERROR`（ID错误）的连接错误。

由于数据包乱序的存在，客户端接收到的**取消推送帧**可能使用了一个尚未被**推送承诺帧**提供过的推送ID。
如果服务器接收到的**取消推送帧**使用了一个尚未用**推送承诺帧**提供过的推送ID，那么 {{< req_level MUST >}}将该情况视作类型为`H3_ID_ERROR`的连接错误。
